# name: üç∑ Train Wine Classifier

# on:
#   workflow_dispatch:
#     inputs:
#       compute_type:
#         description: 'Compute configuration'
#         required: true
#         type: choice
#         options:
#           - 'cpu-light'      # 1 worker, 1 CPU, 2Gi RAM
#           - 'cpu-medium'     # 1 worker, 2 CPU, 4Gi RAM
#           - 'cpu-heavy'      # 2 workers, 2 CPU, 4Gi RAM each
#           - 'gpu-small'      # 1 GPU worker, 2 CPU, 8Gi RAM, 1 GPU
#           - 'gpu-medium'     # 1 GPU worker, 4 CPU, 16Gi RAM, 1 GPU
#         default: 'cpu-medium'
#       entrypoint:
#         description: 'Training script entrypoint'
#         required: true
#         default: 'python src/training/train.py'
#         type: string
#       extra_args:
#         description: 'Additional arguments (e.g., --epochs 50 --batch-size 32)'
#         required: false
#         type: string
#       experiment_name:
#         description: 'MLflow experiment name'
#         required: false
#         default: wine-quality
#         type: string

# jobs:
#   train:
#     name: Wine Classifier Training
#     uses: opencloudhub/.github/.github/workflows/shared-training-ray.yaml@main
#     with:
#       compute_type: ${{ inputs.compute_type }}
#       docker_image: "opencloudhuborg/wine-classifier-training:latest"
#       entrypoint: ${{ inputs.entrypoint }}
#       extra_args: ${{ inputs.extra_args }}
#       experiment_name: ${{ inputs.experiment_name }}
#     secrets: inherit

name: Train Model
# TODO: check the required true/false stuff
on:
  workflow_dispatch:
    inputs:
      training_entrypoint:
        description: 'Training script entrypoint'
        required: false
        type: string
        default: 'python src/training/train.py'
      training_args:
        description: 'Additional training arguments'
        required: false
        type: string
        default: ''
      compute_type:
        description: 'Compute configuration'
        required: true
        type: choice
        options:
          - cpu-small
          - cpu-medium
          - cpu-large
          - gpu-small
          - gpu-medium
          - gpu-large
        default: 'cpu-small'
      approval_mode:
        description: 'Approval mode'
        required: true
        type: choice
        options:
          - manual
          - automatic
        default: 'manual'
      comparison_metric:
        description: 'Metric to compare models'
        required: false
        type: string
        default: 'accuracy'
      comparison_direction:
        description: "Direction to compare metrics"
        type: choice
        required: false
        option:
          - higher
          - lower
        default: 'higher'
      comparison_threshold:
        description: 'Minimum improvement threshold (0.05 = 5%)'
        required: false
        type: string
        default: '0.05'

jobs:
  train:
    uses: opencloudhub/.github/.github/workflows/shared-argo-ml-workflow.yaml@main
    with:
      model_name: "wine-classifier"
      experiment_name: "wine-quality-prediction"
      compute_type: ${{ inputs.compute_type }}
      approval_mode: ${{ inputs.approval_mode }}
      comparison_metric: ${{ inputs.comparison_metric }}
      comparison_direction: ${{ inputs.comparison_direction}}
      comparison_threshold: ${{ inputs.comparison_threshold }}
      training_image: "ghcr.io/opencloudhub/wine-classifier-training:latest"
      training_entrypoint: ${{ inputs.training_entrypoint }}
      training_args: ${{ inputs.training_args }}
    secrets: inherit